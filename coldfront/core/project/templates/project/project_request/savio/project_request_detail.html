{% extends "common/base.html" %}
{% load crispy_forms_tags %}
{% load common_tags %}
{% load static %}


{% block title %}
Savio Project Request Detail
{% endblock %}


{% block content %}
<h1>Review Savio Project Request</h1>
<hr>

<p>This form activates a request for a Savio project. Please review the given information and complete the checklist before final approval.</p>

{% include 'project/project_request/savio/project_request_card.html' with savio_request=savio_request %}

<div class="card mb-3">
  <div class="card-header">
    <h4>
      <i class="fas fa-check-circle" aria-hidden="true"></i>
      Checklist
    </h4>
  </div>
  <div class="card-body">
    <p>Complete the checklist below in the following order.</p>
    <div class="table-responsive">
      <table class="table table-sm">
        <thead>
          <tr>
            <th scope="col">Task</th>
            <th scope="col">Status</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody>
          {% with eligibility=savio_request.state.eligibility readiness=savio_request.state.readiness setup=savio_request.state.setup %}
            <tr>
              <td>Confirm that the requested PI is eligible for a Savio allowance.</td>
              <td>
                {% if eligibility.status == 'Pending' %}
                  <span class="badge badge-warning">
                    {{ eligibility.status }}
                  </span>
                {% elif eligibility.status == 'Approved' %}
                  <span class="badge badge-success">
                    {{ eligibility.status }} {{ eligibility.timestamp }}
                  </span>
                {% else %}
                  <span class="badge badge-danger">
                    {{ eligibility.status }} {{ eligibility.timestamp }}
                  </span>
                {% endif %}
              </td>
              <td>
                <a href="{% url 'savio-project-request-review-eligibility' savio_request.pk %}" class="btn btn-primary">
                  Manage
                </a>
            </tr>
            <tr>
              <td>Confirm that the project satisfies the readiness.status criteria.</td>
              <td>
                {% if eligibility.status == 'Denied' %}
                  <span class="badge badge-danger">
                    N/A
                  </span>
                {% elif readiness.status == 'Pending' %}
                  <span class="badge badge-warning">
                    {{ readiness.status }}
                  </span>
                {% elif readiness.status == 'Approved' %}
                  <span class="badge badge-success">
                    {{ readiness.status }} {{ readiness.timestamp }}
                  </span>
                {% else %}
                  <span class="badge badge-danger">
                    {{ readiness.status }} {{ readiness.timestamp }}
                  </span>
                {% endif %}
              </td>
              <td>
                {% if eligibility.status == 'Approved' %}
                  <a href="{% url 'savio-project-request-review-readiness' savio_request.pk %}" class="btn btn-primary">
                    Manage
                  </a>
                {% else %}
                  <button class="btn btn-primary" disabled="true">
                    Manage
                  </button>
                {% endif %}
              </td>
            </tr>
            <tr>
              <td>Perform project setup on the cluster.</td>
              <td>
                {% if eligibility.status == 'Denied' or readiness.status == 'Denied' %}
                  <span class="badge badge-danger">
                    N/A
                  </span>
                {% elif setup.status == 'Pending' %}
                  <span class="badge badge-warning">
                    {{ setup.status }}
                  </span>
                {% else %}
                  <span class="badge badge-success">
                    {{ setup.status }} {{ setup.timestamp }}
                  </span>
                {% endif %}
              </td>
              <td>
                {% if eligibility.status == 'Approved' and readiness.status == 'Approved' %}
                  <a href="{% url 'savio-project-request-review-setup' savio_request.pk %}" class="btn btn-primary">
                    Manage
                  </a>
                {% else %}
                  <button class="btn btn-primary" disabled="true">
                    Manage
                  </button>
                {% endif %}
              </td>
            </tr>
          {% endwith %}
        </tbody>
      </table>
    </div>
  </div>
</div>

<button type="button" class="btn btn-success" disabled>Submit</button>
<a href="{% url 'savio-project-request-list' %}" class="btn btn-secondary">Cancel</a>

{% include 'project/project_request/savio/project_request_survey_modal.html' with survey_form=survey_form %}

{% endblock %}
